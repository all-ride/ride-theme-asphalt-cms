function initializeContent(a){var b=$(document),c=$("body"),d=($(".form-widget-add"),$(".modal-widget-add")),e=$(".widget-add-submit"),f=$(".widget-add-submit-close"),g=$(".modal-section-action"),h=$(".section-action-submit"),i=$(".section .block"),j=$(".sections"),k=$(".widget--compact"),l=$(".js-toggle-available"),m=[$(".section-delete"),$(".section__handle"),$(".widget__handle"),$(".widget-add"),$(".section-add")],n=!1,o=function(){var b=$("input[name=widget]:checked").val();if(!b)return void alert("no widget selected");var c=$("input[name=section]").val(),d=$("input[name=block]").val(),g=$(".section[data-section="+c+"] .block[data-block="+d+"]",j);if(1!=g.length)return void alert("no block found");e.attr("disabled","disabled"),f.attr("disabled","disabled");var h=$.post(a+"/sections/"+c+"/block/"+d+"/widget/"+b,function(b){$lockedWidget=g.find(".widget--locked");$lockedWidget.before(b);q(a,!0),t(),e.removeAttr("disabled"),f.removeAttr("disabled")});rideApp.common.handleXHRCallback(h,"Widget added","Could not add widget")},p=function(a){var b={};$(".section").each(function(){var a=$(this),c="section"+a.data("section");void 0==b[c]&&(b[c]={}),$(".block",a).each(function(){var a=$(this),d=a.data("block"),e=$(".widget:not(.widget--locked)",a);e.length?(b[c][d]=[],e.each(function(){b[c][d].push($(this).data("widget"))})):b[c][d]=0})});var c=$.post(a+"/order",{order:b},function(a){});rideApp.common.handleXHRCallback(c,"Order updated","Could not update order")},q=function(a,b){void 0!=b&&b&&i.each(function(){try{$(this).sortable("destroy")}catch(a){console.log(a)}}),i.sortable({handle:".handle",items:"> .widget:not(.widget--locked)",connectWith:i,update:function(b,c){this===c.item.parent()[0]&&p(a)},over:function(a,b){b.placeholder.insertBefore($(this).children(".widget.widget--locked:first"))},activate:function(a,b){c.addClass("is-sorting")},deactivate:function(a,b){c.removeClass("is-sorting")}})},r=function(){var a=i.add(j);a.each(function(){try{$(this).sortable("destroy")}catch(a){console.log(a)}})},s=function(){j.sortable({handle:".panel-heading .handle",items:"> .section",update:function(b,c){p(a)},activate:function(a,b){c.addClass("is-sorting")},deactivate:function(a,b){c.removeClass("is-sorting")}})},t=function(){$(".section:not(.is-initialized)").addClass("is-initialized").find(".section__actions .action").on("click",function(a){a.preventDefault();var b=$(this),c=b.attr("href");"#"!=c[0]&&g.find(".modal-body").load(c+" form",function(){g.find(".modal-title").text(b.attr("title")),g.find(".form__actions").hide(),g.modal("show")})})},u=function(){m.forEach(function(a){a.hide("fast")}),n=!0},v=function(){m.forEach(function(a){a.show("fast")}),n=!1},w=function(a){var b=$(".widget.is-locked");a.is(":checked")?(b.stop().hide("fast"),u(),r()):(b.stop().show("fast"),s(),q(),v())},x=function(){$("div.section").each(function(){var a=$(this).find("div.widget"),b=$(this).find("div.is-unavailable");a.length>0&&a.length===b.length&&$(this).stop().toggle("fast")})};b.on("click",".section-add",function(b){if(!n){b.preventDefault();var c,d=$(this).data("method"),e=$.post(a+"/sections",function(b){switch(d){case"prepend":c=j.prepend(b);break;case"append":default:c=j.append(b)}q(a,!0),t(),$(".section:last",j).scrollTop()});rideApp.common.handleXHRCallback(e,"Section added","Could not add section")}}),b.on("click",".section-delete",function(b){if(b.preventDefault(),!n){var c=$(this);if(confirm(c.data("confirm"))){var d=c.closest(".section"),e=$.ajax({url:a+"/sections/"+d.data("section"),type:"DELETE",success:function(b){d.remove(),q(a,!0)}});rideApp.common.handleXHRCallback(e,"Section removed","Could not remove section")}}}),b.on("click",".section__layouts > a",function(b){if(b.preventDefault(),!n){var c=$(this),d=c.closest(".section"),e=$.post(a+"/sections/"+d.data("section")+"/layout/"+c.data("layout"),function(b){d=d.replaceWith(b),q(a,!0),t()});rideApp.common.handleXHRCallback(e,"Section layout changed","Could not change section layout")}}),b.on("click",".widget-add",function(a){if(!n){var b=$(this),c=b.parents(".block"),e=b.parents(".section");0==c.length&&(c=$(".block",e).first()),$("input[name=section]").val(e.data("section")),$("input[name=block]").val(c.data("block")),d.modal("show")}}),e.on("click",function(a){a.preventDefault(),o()}),f.on("click",function(a){a.preventDefault(),o(),d.modal("hide")}),b.on("click",".widget-delete",function(b){if(b.preventDefault(),!n){var c=$(this);if(confirm(c.data("confirm"))){var d=c.closest(".section"),e=c.closest(".block"),f=c.closest(".widget"),g=$.ajax({url:a+"/sections/"+d.data("section")+"/block/"+e.data("block")+"/widget/"+f.data("widget"),type:"DELETE",success:function(a){f.remove()}});rideApp.common.handleXHRCallback(g,"Widget removed","Could not remove widget")}}}),l.on("change",function(){x(),w($(this))}),$("#filter-widgets").on("keyup",function(a){if(13==a.which)return!1;var b=$(this).val();k.parent().show();k.filter(function(){var a=$(this).text(),c=new RegExp(b,"i"),d=a.search(c);return d<0}).parent().hide()}),h.on("click",function(a){a.preventDefault();var b=g.find("form"),c=$.post(b.attr("action"),b.serialize(),function(){g.modal("hide")});rideApp.common.handleXHRCallback(c,"Updated section properties","Could not update section properties")}),s(),q(a),t(),w(l)}+function(a){"use strict";function b(b,d){return this.each(function(){var e=a(this),f=e.data("bs.modal"),g=a.extend({},c.DEFAULTS,e.data(),"object"==typeof b&&b);f||e.data("bs.modal",f=new c(this,g)),"string"==typeof b?f[b](d):g.show&&f.show(d)})}var c=function(b,c){this.options=c,this.$body=a(document.body),this.$element=a(b),this.$backdrop=this.isShown=null,this.scrollbarWidth=0,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,a.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};c.VERSION="3.3.1",c.TRANSITION_DURATION=300,c.BACKDROP_TRANSITION_DURATION=150,c.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},c.prototype.toggle=function(a){return this.isShown?this.hide():this.show(a)},c.prototype.show=function(b){var d=this,e=a.Event("show.bs.modal",{relatedTarget:b});this.$element.trigger(e),this.isShown||e.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',a.proxy(this.hide,this)),this.backdrop(function(){var e=a.support.transition&&d.$element.hasClass("fade");d.$element.parent().length||d.$element.appendTo(d.$body),d.$element.show().scrollTop(0),d.options.backdrop&&d.adjustBackdrop(),d.adjustDialog(),e&&d.$element[0].offsetWidth,d.$element.addClass("in").attr("aria-hidden",!1),d.enforceFocus();var f=a.Event("shown.bs.modal",{relatedTarget:b});e?d.$element.find(".modal-dialog").one("bsTransitionEnd",function(){d.$element.trigger("focus").trigger(f)}).emulateTransitionEnd(c.TRANSITION_DURATION):d.$element.trigger("focus").trigger(f)}))},c.prototype.hide=function(b){b&&b.preventDefault(),b=a.Event("hide.bs.modal"),this.$element.trigger(b),this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),a(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal"),a.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",a.proxy(this.hideModal,this)).emulateTransitionEnd(c.TRANSITION_DURATION):this.hideModal())},c.prototype.enforceFocus=function(){a(document).off("focusin.bs.modal").on("focusin.bs.modal",a.proxy(function(a){this.$element[0]===a.target||this.$element.has(a.target).length||this.$element.trigger("focus")},this))},c.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",a.proxy(function(a){27==a.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},c.prototype.resize=function(){this.isShown?a(window).on("resize.bs.modal",a.proxy(this.handleUpdate,this)):a(window).off("resize.bs.modal")},c.prototype.hideModal=function(){var a=this;this.$element.hide(),this.backdrop(function(){a.$body.removeClass("modal-open"),a.resetAdjustments(),a.resetScrollbar(),a.$element.trigger("hidden.bs.modal")})},c.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},c.prototype.backdrop=function(b){var d=this,e=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var f=a.support.transition&&e;if(this.$backdrop=a('<div class="modal-backdrop '+e+'" />').prependTo(this.$element).on("click.dismiss.bs.modal",a.proxy(function(a){a.target===a.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),f&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!b)return;f?this.$backdrop.one("bsTransitionEnd",b).emulateTransitionEnd(c.BACKDROP_TRANSITION_DURATION):b()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var g=function(){d.removeBackdrop(),b&&b()};a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",g).emulateTransitionEnd(c.BACKDROP_TRANSITION_DURATION):g()}else b&&b()},c.prototype.handleUpdate=function(){this.options.backdrop&&this.adjustBackdrop(),this.adjustDialog()},c.prototype.adjustBackdrop=function(){this.$backdrop.css("height",0).css("height",this.$element[0].scrollHeight)},c.prototype.adjustDialog=function(){var a=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&a?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!a?this.scrollbarWidth:""})},c.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},c.prototype.checkScrollbar=function(){this.bodyIsOverflowing=document.body.scrollHeight>document.documentElement.clientHeight,this.scrollbarWidth=this.measureScrollbar()},c.prototype.setScrollbar=function(){var a=parseInt(this.$body.css("padding-right")||0,10);this.bodyIsOverflowing&&this.$body.css("padding-right",a+this.scrollbarWidth)},c.prototype.resetScrollbar=function(){this.$body.css("padding-right","")},c.prototype.measureScrollbar=function(){var a=document.createElement("div");a.className="modal-scrollbar-measure",this.$body.append(a);var b=a.offsetWidth-a.clientWidth;return this.$body[0].removeChild(a),b};var d=a.fn.modal;a.fn.modal=b,a.fn.modal.Constructor=c,a.fn.modal.noConflict=function(){return a.fn.modal=d,this},a(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(c){var d=a(this),e=d.attr("href"),f=a(d.attr("data-target")||e&&e.replace(/.*(?=#[^\s]+$)/,"")),g=f.data("bs.modal")?"toggle":a.extend({remote:!/#/.test(e)&&e},f.data(),d.data());d.is("a")&&c.preventDefault(),f.one("show.bs.modal",function(a){a.isDefaultPrevented()||f.one("hidden.bs.modal",function(){d.is(":visible")&&d.trigger("focus")})}),b.call(f,g,this)})}(jQuery);